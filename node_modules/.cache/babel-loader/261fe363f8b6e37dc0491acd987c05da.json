{"ast":null,"code":"export const script = `\nimport NonFungibleToken from 0x1d7e57aa55817448\nimport BloctoPass from 0x0f9df91c9121c460\n\npub fun main( addr: Address) : [UFix64] {\n\n\n  if  getAccount(addr).getCapability<&{NonFungibleToken.CollectionPublic, BloctoPass.CollectionPublic}>(BloctoPass.CollectionPublicPath).borrow() == nil {\n    return []\n  }\n\n  let ref = getAccount(addr).getCapability<&{NonFungibleToken.CollectionPublic, BloctoPass.CollectionPublic}>(BloctoPass.CollectionPublicPath)\n            .borrow() ?? panic(\"Cannot get reference to Blocto Token Lock\")\n  \n\n\n  let ids = ref.getIDs()\n  let length = UInt64(ref.getIDs().length) - 1\n  let id = ids[length]\n\n  let passRef = ref.borrowBloctoPassPublic(id: id)\n  let lockupSchedule = passRef.getLockupSchedule()\n  let lockupAmount = passRef.getLockupAmountAtTimestamp(timestamp: 0.0)\n\n  // Function to decode the unlocking schedule and amount\n  let timestamp = getCurrentBlock().timestamp\n  let keys = lockupSchedule.keys\n  var closestTimestamp = UFix64.max\n  var lockupPercentage = UFix64.max\n\n  for key in keys {\n    if timestamp <= key && key <= closestTimestamp {\n        lockupPercentage = lockupSchedule[key]!\n        closestTimestamp = key\n    }\n  }\n\n  var lastclosestTimestamp = 0.0\n  var lastlockupPercentage = 0.0\n\n  for key in keys {\n      if timestamp >= key && key >= lastclosestTimestamp {\n          lastlockupPercentage = lockupSchedule[key]!\n          lastclosestTimestamp = key\n      }\n  }\n\n  let amount = lockupAmount * (lastlockupPercentage - lockupPercentage)\n\n\n  return [closestTimestamp , amount]\n\n} \n`;","map":{"version":3,"sources":["C:/Users/benh6/Documents/GitHub/Locked-token-check/src/cadence/code.js"],"names":["script"],"mappings":"AAEA,OAAO,MAAMA,MAAM,GAAI;AACvB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,CArDO","sourcesContent":["\r\n\r\nexport const script = `\r\nimport NonFungibleToken from 0x1d7e57aa55817448\r\nimport BloctoPass from 0x0f9df91c9121c460\r\n\r\npub fun main( addr: Address) : [UFix64] {\r\n\r\n\r\n  if  getAccount(addr).getCapability<&{NonFungibleToken.CollectionPublic, BloctoPass.CollectionPublic}>(BloctoPass.CollectionPublicPath).borrow() == nil {\r\n    return []\r\n  }\r\n\r\n  let ref = getAccount(addr).getCapability<&{NonFungibleToken.CollectionPublic, BloctoPass.CollectionPublic}>(BloctoPass.CollectionPublicPath)\r\n            .borrow() ?? panic(\"Cannot get reference to Blocto Token Lock\")\r\n  \r\n\r\n\r\n  let ids = ref.getIDs()\r\n  let length = UInt64(ref.getIDs().length) - 1\r\n  let id = ids[length]\r\n\r\n  let passRef = ref.borrowBloctoPassPublic(id: id)\r\n  let lockupSchedule = passRef.getLockupSchedule()\r\n  let lockupAmount = passRef.getLockupAmountAtTimestamp(timestamp: 0.0)\r\n\r\n  // Function to decode the unlocking schedule and amount\r\n  let timestamp = getCurrentBlock().timestamp\r\n  let keys = lockupSchedule.keys\r\n  var closestTimestamp = UFix64.max\r\n  var lockupPercentage = UFix64.max\r\n\r\n  for key in keys {\r\n    if timestamp <= key && key <= closestTimestamp {\r\n        lockupPercentage = lockupSchedule[key]!\r\n        closestTimestamp = key\r\n    }\r\n  }\r\n\r\n  var lastclosestTimestamp = 0.0\r\n  var lastlockupPercentage = 0.0\r\n\r\n  for key in keys {\r\n      if timestamp >= key && key >= lastclosestTimestamp {\r\n          lastlockupPercentage = lockupSchedule[key]!\r\n          lastclosestTimestamp = key\r\n      }\r\n  }\r\n\r\n  let amount = lockupAmount * (lastlockupPercentage - lockupPercentage)\r\n\r\n\r\n  return [closestTimestamp , amount]\r\n\r\n} \r\n`"]},"metadata":{},"sourceType":"module"}